#!/usr/bin/env -S v -raw-vsh-tmp-prefix tmp run

import os
import term

fn move_docs_to_svelte() ! {
	docs_dir := 'site/src/routes/docs/[...10]reference'
	source_dir := 'docs/reference'
	println('Copying docs from ${source_dir} to ${docs_dir}')
	os.mkdir_all(docs_dir)!
	if os.exists(source_dir) {
		files := os.glob('${source_dir}/*.md') or { []string{} }
		for file in files {
			dest_file := os.join_path(docs_dir, os.base(file))
			println(' - Copying ${os.base(file)}')
			os.cp(file, dest_file) or { println(term.fail_message('Error copying ${file}')) }
		}
	} else {
		println(term.fail_message('No documentation found in docs/reference'))
	}
}

// Get the command from arguments
mut cmd := 'help'
if os.args.len > 1 {
	cmd = os.args[1]
}

if cmd == 'docs' {
	// Alias for build docs
	println(term.ok_message('Generating documentation...'))

	// Run doxygen to generate markdown
	result := os.execute('doxygen Doxyfile')
	if result.exit_code != 0 {
		println(term.fail_message('Doxygen failed to run: ${result.output}'))
		return
	}

	println(term.ok_message('Documentation generated successfully!'))
	println(term.ok_message('Moving documentation to SvelteKit routes...'))

	move_docs_to_svelte() or { println(term.fail_message('Error copying docs to svelte ${err}')) }

	println(term.ok_message('Documentation integrated into Svelte site!'))
} else if cmd == 'help' {
	println('Gama Documentation Generator')
	println('Usage: mng build|docs')
	println('  build/docs - Generate Doxygen documentation and integrate into Svelte site')
	println('  help       - Show this help message')
} else {
	println(term.fail_message('Unknown command: ${cmd}'))
	println('Run "mng help" for available commands')
}
