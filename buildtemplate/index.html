<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width; initial-scale=1;" />
  <title>Gama Web App</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #1e1e1e;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>

<body>
  <canvas id="gama-canvas"></canvas>

  <script src="gama.js"></script>
  <script>
    const canvas = document.getElementById('gama-canvas');

    // Check for OffscreenCanvas support early
    if (!canvas.transferControlToOffscreen) {
      throw new Error("Your browser does not support OffscreenCanvas. This application cannot run.");
    }

    // Load the Wasm module and attach it to the canvas
    Gama.load('./game.wasm')
      .then(gamaInstance => {
        gamaInstance.attachCanvas(canvas);
      })
      .catch(error => {
        console.error("Error loading Gama application:", error);
      });

    // Hot-reloading client
    const ws = new WebSocket("ws://" + window.location.host + "/ws");
    ws.onmessage = (event) => {
      if (event.data === "reload") {
        console.log("File change detected, reloading...");
        location.reload();
      }
    };
    ws.onopen = () => console.log("Hot-reload WebSocket connected.");
    ws.onclose = () => console.warn("Hot-reload WebSocket disconnected. Hot-reloading will not work.");
    ws.onerror = (err) => console.error("Hot-reload WebSocket error:", err);
  </script>
</body>

</html>
